<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Rooftop Gambling</title>
<style>
  :root{
    --bg:#0b1020; --card:#0f1530; --card2:#171f47; --accent:#ffb703;
    --good:#7aff9a; --bad:#ff6b8b; --ui:#e9f1ff; --glow:#38bdf8;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font:500 16px/1.5 Inter,system-ui,Segoe UI,Arial; color:var(--ui);
    background:
      radial-gradient(1200px 600px at 20% 20%, #12214a, transparent 60%),
      radial-gradient(900px 700px at 80% 60%, #1b2a58, transparent 60%),
      linear-gradient(180deg, var(--bg), #0a1329);
    display:flex; min-height:100vh;
  }
  /* Sidebar */
  .sidebar{
    width:230px; background:rgba(14,21,48,.65); backdrop-filter:blur(10px);
    padding:20px; position:sticky; top:0; height:100vh; border-right:1px solid #0d1333; overflow:auto;
  }
  .brand{
    margin:0 0 14px; color:var(--accent); letter-spacing:.6px; font-weight:900;
    text-shadow:0 0 18px rgba(255,183,3,.35);
  }
  .balanceBox{
    background:linear-gradient(145deg, rgba(23,31,71,.8), rgba(18,25,55,.7));
    border-radius:14px; padding:14px; margin-bottom:14px; border:1px solid #0e1435; box-shadow:0 8px 20px rgba(0,0,0,.25);
  }
  .balanceBox b{color:var(--good)}
  .nav a{
    display:block; padding:11px 12px; border-radius:10px; text-decoration:none; color:var(--ui);
    margin:6px 0; background:rgba(20,28,62,.7); border:1px solid #0f1638; transition:.15s;
  }
  .nav a:hover{background:#1b2550}
  .nav a.active{outline:2px solid var(--accent); box-shadow:0 0 12px rgba(255,183,3,.25) inset}

  /* Main */
  .main{flex:1; padding:20px; max-width:1280px; margin:0 auto}
  header{
    background:linear-gradient(145deg, #141b40, #0e1736); padding:14px 16px; border-radius:14px;
    display:flex; justify-content:space-between; align-items:center; border:1px solid #101744;
    box-shadow:0 10px 24px rgba(0,0,0,.25), inset 0 0 20px rgba(56,189,248,.06);
  }
  header h1{margin:0; font-size:18px; color:var(--accent)}
  .pill{background:#101946; padding:8px 12px; border-radius:999px; border:1px solid #0f1638; box-shadow:0 0 14px rgba(56,189,248,.18) inset}
  .good{color:var(--good)} .bad{color:var(--bad)}
  .muted{opacity:.85}

  .grid{display:grid; grid-template-columns:repeat(auto-fit,minmax(230px,1fr)); gap:18px; margin-top:20px}
  .card{
    background:linear-gradient(180deg, rgba(23,31,71,.8), rgba(13,19,51,.85));
    border:1px solid #101744; border-radius:14px; padding:16px; box-shadow:0 10px 22px rgba(0,0,0,.25);
  }
  .cta{
    display:inline-block; margin-top:10px; background:linear-gradient(90deg, #ffb703, #ff7f11);
    color:#111; border:0; border-radius:10px; padding:10px 14px; cursor:pointer; font-weight:800; box-shadow:0 6px 18px rgba(255,127,17,.35);
  }

  input[type="number"], input[type="text"], select{
    width:170px; background:#0e1739; color:var(--ui); border:1px solid #0f1638; border-radius:10px; padding:10px; margin:6px 6px 6px 0; outline:none;
    box-shadow:0 3px 10px rgba(0,0,0,.25) inset;
  }
  button{background:linear-gradient(90deg,#ffb703,#ff7f11); color:#111; border:0; border-radius:10px; padding:10px 14px; cursor:pointer; font-weight:800; box-shadow:0 6px 18px rgba(255,127,17,.35)}
  button.secondary{background:#0f1739; color:#e9f1ff; border:1px solid #15205a; box-shadow:none}
  .row{display:flex; flex-wrap:wrap; gap:10px; align-items:center}
  .stat{display:inline-block; background:#0e1739; border:1px solid #0f1638; border-radius:10px; padding:8px 10px; margin-right:8px}
  .spacer{height:10px}

  /* Boards */
  .board5{ display:grid; grid-template-columns:repeat(5,64px); gap:10px; justify-content:center; margin:16px 0; }
  .cell{
    width:64px; height:64px; background:linear-gradient(180deg,#151f52,#0f1738); border-radius:12px; border:1px solid #0d1333; cursor:pointer;
    display:flex; align-items:center; justify-content:center; font-size:22px; user-select:none; box-shadow:0 6px 16px rgba(0,0,0,.35);
    transition:transform .12s ease, box-shadow .12s ease;
  }
  .cell:hover{ transform:translateY(-2px); box-shadow:0 10px 20px rgba(0,0,0,.4)}
  .cell.revealed{background:linear-gradient(180deg,#1d2a66,#132054)}
  .cell.bomb{background:linear-gradient(180deg,#6c1f2c,#4c1520); border-color:#812535}

  /* Dice */
  #diceFaces{font-size:46px; letter-spacing:8px; text-shadow:0 0 18px rgba(56,189,248,.25)}
  .under{color:#72f5ff} .over{color:#b17dff}

  /* Crash */
  #crashMult{font-size:56px; font-weight:900; margin:8px 0; text-shadow:0 0 22px rgba(122,255,154,.18)}
  #crashStatus{min-height:24px}
  .barWrap{height:12px; background:#0f1739; border:1px solid #0e1435; border-radius:999px; overflow:hidden; box-shadow:0 4px 10px rgba(0,0,0,.2) inset}
  .bar{height:100%; width:0%; background:linear-gradient(90deg,#38bdf8,#7aff9a); box-shadow:0 0 14px rgba(56,189,248,.45)}

  /* Wheel (canvas) */
  .wheelWrap{display:flex; flex-direction:column; align-items:center; gap:10px}
  #wheelCanvas{width:280px; height:280px; filter:drop-shadow(0 10px 24px rgba(0,0,0,.4))}
  .pointer{width:0;height:0;border-left:12px solid transparent;border-right:12px solid transparent;border-bottom:18px solid var(--accent); margin-top:-8px; filter:drop-shadow(0 6px 12px rgba(255,183,3,.4))}

  /* Coinflip (card flip) */
  .coin{
    width:120px;height:120px;border-radius:50%; background:radial-gradient(circle at 35% 30%, #fff6, transparent 35%), linear-gradient(145deg,#1f2b62,#0f1738);
    display:flex; align-items:center; justify-content:center; font-size:44px; border:1px solid #122055;
    box-shadow:inset 0 8px 24px rgba(0,0,0,.35), 0 8px 18px rgba(0,0,0,.35);
    transform-style:preserve-3d; transition:transform .6s;
  }
  .flip{ transform:rotateY(540deg) }
  .star{color:#ffd166; text-shadow:0 0 14px rgba(255,209,102,.45)}
  .heart{color:#ff6b8b; text-shadow:0 0 14px rgba(255,107,139,.45)}

  /* Tower */
  .tower{display:flex; flex-direction:column; gap:10px; align-items:center; margin-top:12px}
  .towerRow{display:flex; gap:10px}
  .tw{width:90px;height:56px;border-radius:10px;border:1px solid #0d1333;background:linear-gradient(180deg,#152054,#0f1738);display:flex;align-items:center;justify-content:center;cursor:pointer; font-size:20px; box-shadow:0 6px 16px rgba(0,0,0,.35)}
  .tw.safe{background:linear-gradient(180deg,#203173,#17245e)}
  .tw.bmb{background:linear-gradient(180deg,#6c1f2c,#4c1520)}
  .levelTag{font-size:12px; opacity:.8}

  /* Toast */
  #toast{
    position:fixed; left:50%; top:20px; transform:translateX(-50%);
    background:#121936; border:1px solid #0e1435; color:#e9f1ff;
    padding:10px 14px; border-radius:10px; font-weight:800; display:none; z-index:99999;
    box-shadow:0 8px 18px rgba(0,0,0,.35)
  }
</style>
</head>
<body>
  <!-- SIDEBAR -->
  <aside class="sidebar">
    <h2 class="brand">Rooftop Gambling</h2>
    <div class="balanceBox">
      Balance: <b id="sbBalance">0</b> 🪙
    </div>
    <nav class="nav">
      <a href="#" data-view="homeView" class="active">🏠 Acasă</a>
      <a href="#" data-view="minesView">💣 Mines</a>
      <a href="#" data-view="diceView">🎲 Dice</a>
      <a href="#" data-view="crashView">🚀 Crash</a>
      <a href="#" data-view="coinView">⭐/❤️ Coinflip</a>
      <a href="#" data-view="wheelView">🎡 Roulette</a>
      <a href="#" data-view="limboView">⚡ Limbo</a>
      <a href="#" data-view="towerView">🏰 Tower</a>
      <a href="#" data-view="codesView">🔑 Coduri</a>
    </nav>
    <p class="muted" style="margin-top:10px;font-size:12px">
      Hawk Tuah.
    </p>
  </aside>

  <!-- MAIN -->
  <main class="main">
    <header>
      <h1>Rooftop Gambling</h1>
      <div class="pill">Balance: <b class="good" id="topBalance">0</b> 🪙</div>
    </header>

    <div id="toast"></div>

    <!-- HOME -->
    <section id="homeView">
      <div class="grid">
        <div class="card"><h3>💣 Mines</h3><p class="muted">Pariu + nr. bombe. Deschizi celule & dai cashout.</p><button class="cta" data-view="minesView">Joacă</button></div>
        <div class="card"><h3>🎲 Dice</h3><p class="muted">Under/Over pe suma a 2 zaruri. Payout corect (distribuție 2–12).</p><button class="cta" data-view="diceView">Joacă</button></div>
        <div class="card"><h3>🚀 Crash</h3><p class="muted">Urcă multiplicatorul. Cashout înainte să „crape”.</p><button class="cta" data-view="crashView">Joacă</button></div>
        <div class="card"><h3>⭐/❤️ Coinflip</h3><p class="muted">Alege ⭐ sau ❤️. Flip 3D. Payout 1.98×.</p><button class="cta" data-view="coinView">Joacă</button></div>
        <div class="card"><h3>🎡 Roulette</h3><p class="muted">Roată reală pe canvas: Red/Blue 2×, Green 14×.</p><button class="cta" data-view="wheelView">Joacă</button></div>
        <div class="card"><h3>⚡ Limbo</h3><p class="muted">Țintă (1.10–10×). Win dacă roll ≥ țintă.</p><button class="cta" data-view="limboView">Joacă</button></div>
        <div class="card"><h3>🏰 Tower</h3><p class="muted">3 cărămizi/level (🧱). Una e bombă 💣. Urcă & retrage.</p><button class="cta" data-view="towerView">Joacă</button></div>
      </div>
    </section>

    <!-- MINES -->
    <section id="minesView" style="display:none">
      <div class="card">
        <h2>💣 Mines</h2>
        <div class="row">
          <label>Pariu: <input type="number" id="m_bet" min="1" value="100"></label>
          <label>Bombe: <input type="number" id="m_bombs" min="1" max="20" value="3"></label>
          <button id="m_start">Start</button>
          <button id="m_cash" class="secondary" disabled>Cash Out</button>
        </div>
        <div class="spacer"></div>
        <div>
          <span class="stat">Multiplicator: <b id="m_mult">1.00x</b></span>
          <span class="stat">Câștig curent: <b id="m_win">0</b> 🪙</span>
          <span class="stat">Pariu: <b id="m_betStat">0</b> 🪙</span>
        </div>
        <div class="board5" id="m_board"></div>
        <p class="muted" id="m_msg"></p>
      </div>
    </section>

    <!-- DICE (2 dice, sum 2..12) -->
    <section id="diceView" style="display:none">
      <div class="card">
        <h2>🎲 Dice</h2>
        <div class="row">
          <label>Pariu: <input type="number" id="d_bet" min="1" value="100"></label>
          <label>Țintă sumă: <input type="number" id="d_target" min="3" max="11" value="7"></label>
          <select id="d_mode"><option value="under">Under (suma &lt; țintă)</option><option value="over">Over (suma &gt; țintă)</option></select>
          <button id="d_roll">Roll</button>
        </div>
        <div class="spacer"></div>
        <div>
          <span class="stat">Șansă: <b id="d_chance">—</b>%</span>
          <span class="stat">Payout potențial: <b id="d_payout">—</b> 🪙</span>
        </div>
        <div id="diceFaces">— —</div>
        <div id="d_result" class="muted"></div>
      </div>
    </section>

    <!-- CRASH -->
    <section id="crashView" style="display:none">
      <div class="card">
        <h2>🚀 Crash</h2>
        <div class="row">
          <label>Pariu: <input type="number" id="c_bet" min="1" value="100"></label>
          <button id="c_start">Start</button>
          <button id="c_cash" class="secondary" disabled>Cash Out</button>
        </div>
        <div class="spacer"></div>
        <div id="crashMult">1.00x</div>
        <div class="barWrap"><div class="bar" id="crashBar"></div></div>
        <div id="crashStatus" class="muted"></div>
      </div>
    </section>

    <!-- COINFLIP (⭐ vs ❤️) -->
    <section id="coinView" style="display:none">
      <div class="card">
        <h2>⭐/❤️ Coinflip</h2>
        <div class="row">
          <label>Pariu: <input type="number" id="cf_bet" min="1" value="100"></label>
          <select id="cf_pick"><option value="star">⭐ Star</option><option value="heart">❤️ Heart</option></select>
          <button id="cf_flip">Flip</button>
        </div>
        <div class="spacer"></div>
        <div class="stat">Payout: <b>1.98×</b></div>
        <div style="display:flex;justify-content:center;margin:12px 0">
          <div class="coin" id="coin"><span id="coinSymbol" class="star">⭐</span></div>
        </div>
        <div id="cf_msg" class="muted"></div>
      </div>
    </section>

    <!-- WHEEL (roulette canvas) -->
    <section id="wheelView" style="display:none">
      <div class="card">
        <h2>🎡 Roulette</h2>
        <p class="muted">Red/Blue plătește <b>2×</b>, Green plătește <b>14×</b>.</p>
        <div class="row">
          <label>Pariu: <input type="number" id="wh_bet" min="1" value="100"></label>
          <select id="wh_pick">
            <option value="red">Red (2×)</option>
            <option value="blue">Blue (2×)</option>
            <option value="green">Green (14×)</option>
          </select>
          <button id="wh_spin">Spin</button>
        </div>
        <div class="spacer"></div>
        <div class="wheelWrap">
          <div class="pointer"></div>
          <canvas id="wheelCanvas" width="560" height="560"></canvas>
        </div>
        <div id="wh_msg" class="muted" style="text-align:center;margin-top:8px"></div>
      </div>
    </section>

    <!-- LIMBO -->
    <section id="limboView" style="display:none">
      <div class="card">
        <h2>⚡ Limbo</h2>
        <p class="muted">Țintă (1.10–10×). Win dacă roll ≥ țintă. Payout ~ 0.97 × țintă.</p>
        <div class="row">
          <label>Pariu: <input type="number" id="lb_bet" min="1" value="100"></label>
          <label>Țintă ×: <input type="number" id="lb_target" step="0.01" min="1.1" max="10" value="2.00"></label>
          <button id="lb_go">GO</button>
        </div>
        <div class="spacer"></div>
        <div class="stat">Payout potențial: <b id="lb_payout">—</b> 🪙</div>
        <div id="lb_roll" style="font-size:32px;font-weight:900;margin:10px 0">—</div>
        <div id="lb_msg" class="muted"></div>
      </div>
    </section>

    <!-- TOWER (FIXED) -->
    <section id="towerView" style="display:none">
      <div class="card">
        <h2>🏰 Tower</h2>
        <p class="muted">8 niveluri. La fiecare nivel ai 3 cărămizi 🧱 (1 bombă 💣). Urcă și poți retrage oricând.</p>
        <div class="row">
          <label>Pariu: <input type="number" id="tw_bet" min="1" value="100"></label>
          <button id="tw_start">Start</button>
          <button id="tw_cash" class="secondary" disabled>Cash Out</button>
        </div>
        <div class="spacer"></div>
        <div>
          <span class="stat">Nivel: <b id="tw_level">0/8</b></span>
          <span class="stat">Multiplicator: <b id="tw_mult">1.00×</b></span>
          <span class="stat">Câștig curent: <b id="tw_win">0</b> 🪙</span>
        </div>
        <div class="tower" id="tw_board"></div>
        <div id="tw_msg" class="muted"></div>
      </div>
    </section>

    <!-- CODES -->
    <section id="codesView" style="display:none">
      <div class="card">
        <h2>🔑 Coduri Gobuxi</h2>
        <p class="muted">Introdu un cod (o singură dată / device).</p>
        <div class="row">
          <input type="text" id="codeInput" placeholder="ex: makeitrain" />
          <button id="codeRedeem">Activează codul</button>
        </div>
        <p id="codeMsg" class="muted"></p>
        <div class="spacer"></div>
        <h3 style="margin:0 0 8px">Istoric coduri</h3>
        <ul id="codeHistory" style="margin:0; padding-left:18px;"></ul>
      </div>
    </section>
  </main>

<script>
/* =================== CORE STATE =================== */
const BALANCE_KEY = "gobuxiBalance_aesthetic_v1";
let balance = parseInt(localStorage.getItem(BALANCE_KEY) || "1000", 10);
const fmt = n => new Intl.NumberFormat('ro-RO').format(n|0);
const setBalance = (v) => {
  balance = Math.max(0, Math.floor(v));
  localStorage.setItem(BALANCE_KEY, String(balance));
  document.getElementById('sbBalance').textContent = fmt(balance);
  document.getElementById('topBalance').textContent = fmt(balance);
};
setBalance(balance);

/* Toast */
function toast(msg){
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.style.display = 'block';
  clearTimeout(t._h); t._h = setTimeout(()=>t.style.display='none', 1400);
}

/* =================== NAV =================== */
const views = ['homeView','minesView','diceView','crashView','coinView','wheelView','limboView','towerView','codesView'];
const showView = (id) => {
  views.forEach(v => document.getElementById(v).style.display = (v===id?'block':'none'));
  document.querySelectorAll('.nav a').forEach(a=>{
    a.classList.toggle('active', a.dataset.view===id);
  });
};
document.querySelectorAll('[data-view]').forEach(el=>{
  el.addEventListener('click', e=>{ e.preventDefault(); showView(el.dataset.view); });
});

(() => {
  // constants for fair math
  const TILES = 25;
  const HOUSE_EDGE = 0.03; // ~3% (same vibe as your Dice/Limbo)

  // DOM refs
  const m = {
    betInp: document.getElementById('m_bet'),
    bombsInp: document.getElementById('m_bombs'),
    startBtn: document.getElementById('m_start'),
    cashBtn: document.getElementById('m_cash'),
    board: document.getElementById('m_board'),
    multEl: document.getElementById('m_mult'),
    winEl: document.getElementById('m_win'),
    betStat: document.getElementById('m_betStat'),
    msg: document.getElementById('m_msg'),
    state: { active:false, bet:0, step:0, mult:1.00, win:0, bombs:[], bombCount:3 }
  };

  // fair cumulative multiplier after `picks` safe reveals with `bombs` bombs
  function minesMultiplier(picks, bombs){
    if (picks <= 0) return 1.0;
    let mult = 1 - HOUSE_EDGE; // apply edge once per run
    for (let i = 0; i < picks; i++){
      // chance next pick is safe at this stage = (safe remaining / tiles remaining)
      mult *= ( (TILES - i) / (TILES - bombs - i) );
    }
    return mult;
  }

  // probability next click is safe (for UX hint)
  function nextSafeChance(picks, bombs){
    return (TILES - bombs - picks) / (TILES - picks);
  }

  function resetUI(){
    m.multEl.textContent = '1.00x';
    m.winEl.textContent = '0';
    m.msg.textContent = '';
  }

  function buildBoard(bombCount){
    m.board.innerHTML = '';
    m.state.step = 0; m.state.mult = 1.00; m.state.win = 0;
    m.state.bombs = [];
    resetUI();

    // place bombs (unique 0..24)
    while(m.state.bombs.length < bombCount){
      const r = Math.floor(Math.random()*TILES);
      if(!m.state.bombs.includes(r)) m.state.bombs.push(r);
    }

    for(let i=0;i<TILES;i++){
      const cell = document.createElement('div');
      cell.className = 'cell';
      cell.addEventListener('click', ()=>{
        if(!m.state.active || cell.classList.contains('revealed')) return;

        if(m.state.bombs.includes(i)){
          // hit bomb -> lose
          cell.classList.add('bomb'); cell.textContent = '💣';
          m.msg.innerHTML = 'Boom! <span class="bad">Ai pierdut pariul.</span>';
          m.state.active = false;
          m.cashBtn.disabled = true;
          // reveal all bombs
          [...m.board.children].forEach((c, idx)=>{
            if(m.state.bombs.includes(idx) && c!==cell){
              c.classList.add('bomb'); c.textContent='💣';
            }
          });
        }else{
          // safe
          cell.classList.add('revealed'); cell.textContent = '🧱';
          m.state.step++;

          // fair multiplier
          m.state.mult = minesMultiplier(m.state.step, m.state.bombCount);
          m.state.win  = Math.floor(m.state.bet * m.state.mult);

          m.multEl.textContent = m.state.mult.toFixed(2)+'x';
          m.winEl.textContent  = fmt(m.state.win);

          const chance = nextSafeChance(m.state.step, m.state.bombCount)*100;
          m.msg.innerHTML = `Șansă next safe: <b>${chance.toFixed(2)}%</b>`;

          m.cashBtn.disabled = false;
        }
      });
      m.board.appendChild(cell);
    }
  }

  // Start
  m.startBtn.addEventListener('click', ()=>{
    const bet = Math.max(1, Math.floor(parseInt(m.betInp.value||'0',10)));
    const bombs = Math.min(24, Math.max(1, parseInt(m.bombsInp.value||'3',10)));
    if(bet>balance){ alert('Fonduri insuficiente.'); return; }

    setBalance(balance - bet);

    m.state.active = true;
    m.state.bet = bet;
    m.state.bombCount = bombs;
    m.betStat.textContent = fmt(bet);
    m.cashBtn.disabled = true;

    buildBoard(bombs);
  });

  // Cash Out
  m.cashBtn.addEventListener('click', ()=>{
    if(!m.state.active || m.state.win<=0) return;
    setBalance(balance + m.state.win);
    m.msg.innerHTML = `✅ Retras <b class="good">${fmt(m.state.win)}</b> 🪙`;
    m.state.active = false;
    m.cashBtn.disabled = true;
  });
})();

/* ================ DICE (2 zaruri) ================ */
// distribuția sumelor 2..12 (număr combinații din 36)
const sumCombos = {2:1,3:2,4:3,5:4,6:5,7:6,8:5,9:4,10:3,11:2,12:1};
const d = {
  bet: document.getElementById('d_bet'),
  target: document.getElementById('d_target'),
  mode: document.getElementById('d_mode'),
  rollBtn: document.getElementById('d_roll'),
  chance: document.getElementById('d_chance'),
  payout: document.getElementById('d_payout'),
  faces: document.getElementById('diceFaces'),
  result: document.getElementById('d_result')
};
const dieChar = n=> String.fromCodePoint(0x2680 + (n-1)); // ⚀..⚅

function diceChance(mode, t){
  let wins=0;
  for(let s=2;s<=12;s++){
    const hit = mode==='under' ? (s < t) : (s > t);
    if(hit) wins += sumCombos[s];
  }
  return wins/36;
}
function updateDiceInfo(){
  const bet = Math.max(1, parseInt(d.bet.value||'0',10));
  const t = Math.min(11, Math.max(3, parseInt(d.target.value||'7',10)));
  d.target.value = t;
  const mode = d.mode.value;
  let chance = diceChance(mode, t);
  chance = Math.max(1/36, Math.min(35/36, chance));
  // payout „fair” cu mic edge 3%
  const mult = 0.97 / chance;
  const pay = Math.floor(bet * mult);
  d.chance.textContent = (chance*100).toFixed(2);
  d.payout.textContent = fmt(pay);
}
['input','change'].forEach(ev=>{
  d.bet.addEventListener(ev, updateDiceInfo);
  d.target.addEventListener(ev, updateDiceInfo);
  d.mode.addEventListener(ev, updateDiceInfo);
});
updateDiceInfo();

d.rollBtn.addEventListener('click', ()=>{
  const bet = Math.max(1, parseInt(d.bet.value||'0',10));
  const t = Math.min(11, Math.max(3, parseInt(d.target.value||'7',10)));
  const mode = d.mode.value;
  if(bet>balance){ alert('Fonduri insuficiente.'); return; }
  setBalance(balance - bet);
  d.rollBtn.disabled = true;
  d.result.textContent = '';

  // animație scurtă
  let k=0;
  const anim = setInterval(()=>{
    const a = 1+Math.floor(Math.random()*6);
    const b = 1+Math.floor(Math.random()*6);
    d.faces.textContent = `${dieChar(a)} ${dieChar(b)}`;
    if(++k>12) { clearInterval(anim);
      const da = 1+Math.floor(Math.random()*6);
      const db = 1+Math.floor(Math.random()*6);
      const sum = da+db;
      d.faces.textContent = `${dieChar(da)} ${dieChar(db)}`;
      const win = (mode==='under') ? (sum < t) : (sum > t);
      const chance = diceChance(mode, t);
      const payout = Math.floor(bet * (0.97/Math.max(1/36,Math.min(35/36, chance))));
      if(win){
        setBalance(balance + payout);
        d.result.innerHTML = `✅ Sumă ${sum}. Ai câștigat <b class="good">${fmt(payout)}</b> 🪙`;
      }else{
        d.result.innerHTML = `❌ Sumă ${sum}. Pariu pierdut (${fmt(bet)}).`;
      }
      d.rollBtn.disabled = false;
      updateDiceInfo();
    }
  }, 60);
});

/* ================ CRASH ================ */
const c = {
  bet: document.getElementById('c_bet'),
  startBtn: document.getElementById('c_start'),
  cashBtn: document.getElementById('c_cash'),
  multEl: document.getElementById('crashMult'),
  status: document.getElementById('crashStatus'),
  bar: document.getElementById('crashBar'),
  state: { active:false, bet:0, mult:1.00, crashAt:1.10, timer:null }
};
function randomCrashAt(){
  const U = Math.random();
  const k = 0.6;
  const val = 1.03 + (-Math.log(Math.max(1e-6, U))) * k;
  return Math.min(12, Math.max(1.05, val));
}
function crashResetUI(){
  c.multEl.textContent = '1.00x';
  c.status.textContent = '';
  c.bar.style.width = '0%';
}
c.startBtn.addEventListener('click', ()=>{
  if(c.state.active) return;
  const bet = Math.max(1, parseInt(c.bet.value||'0',10));
  if(bet>balance){ alert('Fonduri insuficiente.'); return; }
  setBalance(balance - bet);

  c.state.active = true;
  c.state.bet = bet;
  c.state.mult = 1.00;
  c.state.crashAt = randomCrashAt();
  c.cashBtn.disabled = false;
  c.startBtn.disabled = true;
  crashResetUI();

  c.state.timer = setInterval(()=>{
    c.state.mult = (c.state.mult + (c.state.mult<2 ? 0.035 : c.state.mult<4 ? 0.06 : 0.09));
    c.multEl.textContent = `🚀 ${c.state.mult.toFixed(2)}x`;
    c.bar.style.width = Math.min(100, c.state.mult*8)+'%';

    if(c.state.mult >= c.state.crashAt){
      clearInterval(c.state.timer);
      c.state.active = false;
      c.cashBtn.disabled = true;
      c.startBtn.disabled = false;
      c.status.innerHTML = `💥 A crăpat la <b class="bad">${c.state.crashAt.toFixed(2)}x</b>. Pariu pierdut.`;
    }
  }, 80);
});
c.cashBtn.addEventListener('click', ()=>{
  if(!c.state.active) return;
  clearInterval(c.state.timer);
  const win = Math.floor(c.state.bet * c.state.mult);
  setBalance(balance + win);
  c.status.innerHTML = `✅ Cashout la <b class="good">${c.state.mult.toFixed(2)}x</b> — câștig <b class="good">${fmt(win)}</b> 🪙`;
  c.state.active = false;
  c.cashBtn.disabled = true;
  c.startBtn.disabled = false;
});

/* ================ COINFLIP (⭐ / ❤️) ================ */
const cf = {
  bet: document.getElementById('cf_bet'),
  pick: document.getElementById('cf_pick'),
  btn: document.getElementById('cf_flip'),
  coin: document.getElementById('coin'),
  sym: document.getElementById('coinSymbol'),
  msg: document.getElementById('cf_msg')
};
cf.btn.addEventListener('click', ()=>{
  const bet = Math.max(1, parseInt(cf.bet.value||'0',10));
  if(bet>balance){ alert('Fonduri insuficiente.'); return; }
  setBalance(balance - bet);
  cf.btn.disabled = true; cf.msg.textContent = '';
  cf.coin.classList.add('flip');
  setTimeout(()=>{
    cf.coin.classList.remove('flip');
    const res = (Math.random()<0.5)?'star':'heart';
    cf.sym.textContent = (res==='star'?'⭐':'❤️');
    cf.sym.className = res==='star'?'star':'heart';
    const win = (res === cf.pick.value);
    if(win){
      const payout = Math.floor(bet * 1.98);
      setBalance(balance + payout);
      cf.msg.innerHTML = `✅ ${res==='star'?'⭐':'❤️'} — câștig <b class="good">${fmt(payout)}</b> 🪙`;
    }else{
      cf.msg.innerHTML = `❌ Ai pierdut pariul (${fmt(bet)}).`;
    }
    cf.btn.disabled = false;
  }, 900);
});

/* ================ WHEEL / ROULETTE (canvas) ================ */
const wh = {
  bet: document.getElementById('wh_bet'),
  pick: document.getElementById('wh_pick'),
  btn: document.getElementById('wh_spin'),
  msg: document.getElementById('wh_msg'),
  canvas: document.getElementById('wheelCanvas')
};
// segmente: 24 red, 24 blue, 2 green (total 50)
const wheelSegs = [...Array(24).fill('red'), ...Array(24).fill('blue'), 'green', 'green'];
const ctx = wh.canvas.getContext('2d');
let wheelAngle = 0;

function drawWheel(angle=0){
  const cw = wh.canvas.width, ch = wh.canvas.height;
  const cx = cw/2, cy = ch/2, r = Math.min(cx,cy)-10;
  ctx.clearRect(0,0,cw,ch);
  const slice = (Math.PI*2)/wheelSegs.length;
  for(let i=0;i<wheelSegs.length;i++){
    const start = angle + i*slice, end = start + slice;
    ctx.beginPath();
    ctx.moveTo(cx,cy);
    ctx.arc(cx,cy,r,start,end);
    const col = wheelSegs[i]==='red' ? '#ff6b6b' : wheelSegs[i]==='blue' ? '#72f5ff' : '#7aff9a';
    const col2 = wheelSegs[i]==='red' ? '#b94b4b' : wheelSegs[i]==='blue' ? '#3bcfff' : '#35d785';
    const grd = ctx.createLinearGradient(cx,cy-r,cx,cy+r);
    grd.addColorStop(0,col);
    grd.addColorStop(1,col2);
    ctx.fillStyle = grd;
    ctx.fill();
    ctx.strokeStyle = '#0f1638';
    ctx.lineWidth = 2;
    ctx.stroke();
  }
  // centru
  ctx.beginPath();
  ctx.arc(cx,cy,40,0,Math.PI*2);
  ctx.fillStyle = '#0f1739';
  ctx.fill();
  ctx.strokeStyle = '#18225a';
  ctx.stroke();
}
drawWheel(wheelAngle);

wh.btn.addEventListener('click', ()=>{
  const bet = Math.max(1, parseInt(wh.bet.value||'0',10));
  if(bet>balance){ alert('Fonduri insuficiente.'); return; }
  setBalance(balance - bet);
  wh.btn.disabled = true; wh.msg.textContent = '';

  const slice = (Math.PI*2)/wheelSegs.length;
  // alege un index câștigător random
  const idx = Math.floor(Math.random()*wheelSegs.length);
  // țintă: pointerul e sus (unghi  -Math.PI/2). vrem ca mijlocul sectorului să ajungă acolo.
  const targetAngle = -Math.PI/2 - (idx*slice + slice/2);
  // adăugăm câteva ture + easing
  const spins = 6 + Math.random()*2;
  const endAngle = targetAngle + spins*2*Math.PI;

  let start=null;
  function anim(t){
    if(!start) start = t;
    const p = Math.min(1, (t-start)/2000); // 2 sec
    // easeOutCubic
    const eased = 1 - Math.pow(1-p,3);
    wheelAngle = (1-eased)*wheelAngle + eased*endAngle;
    drawWheel(wheelAngle);
    if(p<1) requestAnimationFrame(anim);
    else {
      const res = wheelSegs[idx];
      let payout=0, win=false;
      if(res===wh.pick.value){
        win = true;
        payout = Math.floor(bet * (res==='green' ? 14 : 2));
        setBalance(balance + payout);
        wh.msg.innerHTML = `✅ ${res.toUpperCase()} — câștig <b class="good">${fmt(payout)}</b> 🪙`;
      }else{
        wh.msg.innerHTML = `❌ A ieșit ${res.toUpperCase()}. Pariu pierdut (${fmt(bet)}).`;
      }
      wh.btn.disabled = false;
    }
  }
  requestAnimationFrame(anim);
});

/* ================ LIMBO ================ */
const lb = {
  bet: document.getElementById('lb_bet'),
  target: document.getElementById('lb_target'),
  btn: document.getElementById('lb_go'),
  payout: document.getElementById('lb_payout'),
  roll: document.getElementById('lb_roll'),
  msg: document.getElementById('lb_msg')
};
function updLimbo(){
  const bet = Math.max(1, parseInt(lb.bet.value||'0',10));
  let t = Math.max(1.10, Math.min(10.0, parseFloat(lb.target.value||'2')));
  lb.target.value = t.toFixed(2);
  lb.payout.textContent = fmt(Math.floor(bet * (0.97 * t)));
}
['input','change'].forEach(ev=>{
  lb.bet.addEventListener(ev, updLimbo);
  lb.target.addEventListener(ev, updLimbo);
});
updLimbo();
lb.btn.addEventListener('click', ()=>{
  const bet = Math.max(1, parseInt(lb.bet.value||'0',10));
  let t = Math.max(1.10, Math.min(10.0, parseFloat(lb.target.value||'2')));
  if(bet>balance){ alert('Fonduri insuficiente.'); return; }
  setBalance(balance - bet);
  lb.btn.disabled = true; lb.msg.textContent = '';
  const U = Math.max(1e-6, Math.random());
  const result = Math.min(20, 1 / U);
  lb.roll.textContent = result.toFixed(2)+'×';
  if(result >= t){
    const payout = Math.floor(bet * (0.97 * t));
    setBalance(balance + payout);
    lb.msg.innerHTML = `✅ Hit! Cash <b class="good">${fmt(payout)}</b> 🪙`;
  }else{
    lb.msg.innerHTML = `❌ Miss. Ținta era ${t.toFixed(2)}×.`;
  }
  lb.btn.disabled = false;
  updLimbo();
});

/* ================ TOWER (BUGFIXED) ================ */
const tw = {
  bet: document.getElementById('tw_bet'),
  start: document.getElementById('tw_start'),
  cash: document.getElementById('tw_cash'),
  board: document.getElementById('tw_board'),
  lvlEl: document.getElementById('tw_level'),
  multEl: document.getElementById('tw_mult'),
  winEl: document.getElementById('tw_win'),
  msg: document.getElementById('tw_msg'),
  state: { active:false, bet:0, level:0, bombs:[], win:0, mult:1.00 }
};
function twBuild(){
  tw.board.innerHTML = '';
  tw.state.bombs = [];
  for(let i=0;i<8;i++){
    const row = document.createElement('div');
    row.className='towerRow';
    // bomb index
    const bIdx = Math.floor(Math.random()*3);
    tw.state.bombs.push(bIdx);
    for(let j=0;j<3;j++){
      const b = document.createElement('div');
      b.className='tw';
      b.textContent='🧱';
      ((lvl, idx, el)=>{
        el.addEventListener('click', ()=>{
          if(!tw.state.active || lvl!==tw.state.level) return;
          if(tw.state.bombs[lvl] === idx){
            el.classList.add('bmb'); el.textContent='💣';
            tw.msg.innerHTML = 'Boom! <span class="bad">Pariu pierdut.</span>';
            tw.state.active=false; tw.cash.disabled = true;
            // dezvăluie cele safe
            [...row.children].forEach((x,k)=>{ if(k!==idx){ x.classList.add('safe'); x.textContent='✔️'; }});
          }else{
            el.classList.add('safe'); el.textContent='✔️';
            tw.state.level++;
            tw.state.mult = 1 + tw.state.level*0.15;
            tw.state.win = Math.floor(tw.state.bet * tw.state.mult);
            tw.lvlEl.textContent = `${tw.state.level}/8`;
            tw.multEl.textContent = tw.state.mult.toFixed(2)+'×';
            tw.winEl.textContent = fmt(tw.state.win);
            tw.cash.disabled = false;
            if(tw.state.level===8){
              tw.msg.innerHTML = `🏆 Max level! Retrage <b class="good">${fmt(tw.state.win)}</b> 🪙`;
              tw.state.active=false; // poți încă să dai cash
              tw.cash.disabled = false;
            }
          }
        });
      })(i,j,b);
      row.appendChild(b);
    }
    tw.board.appendChild(row);
  }
  tw.lvlEl.textContent = '0/8';
  tw.multEl.textContent = '1.00×';
  tw.winEl.textContent = '0';
  tw.msg.textContent = '';
}
tw.start.addEventListener('click', ()=>{
  const bet = Math.max(1, parseInt(tw.bet.value||'0',10));
  if(bet>balance){ alert('Fonduri insuficiente.'); return; }
  setBalance(balance - bet);
  tw.state = { active:true, bet, level:0, bombs:[], win:0, mult:1.00 };
  tw.cash.disabled = true;
  twBuild();
});
tw.cash.addEventListener('click', ()=>{
  if(tw.state.win<=0) return; // poți retrage și dacă run-ul s-a terminat la max level
  setBalance(balance + tw.state.win);
  tw.msg.innerHTML = `✅ Retras <b class="good">${fmt(tw.state.win)}</b> 🪙`;
  tw.state.active = false;
  tw.cash.disabled = true;
});

/* ================ CODES (TAB) ================ */
const VALID_CODES = {
  "makeitrain": 250,
  "delta": 100,
  "gobuxi777": 777,
  "konami": 10000,
  "andrei": 2000,
  "picu": 1650,
  "luca": 2350
  "picuuu": 10000
};
const REDEEMED_KEY = "gobuxiRedeemed_v1";
let redeemed = JSON.parse(localStorage.getItem(REDEEMED_KEY) || "[]");

const codeInput = document.getElementById('codeInput');
const codeRedeem = document.getElementById('codeRedeem');
const codeMsg = document.getElementById('codeMsg');
const codeHistory = document.getElementById('codeHistory');

function saveRedeemed(){
  localStorage.setItem(REDEEMED_KEY, JSON.stringify(redeemed));
  renderHistory();
}
function renderHistory(){
  codeHistory.innerHTML = redeemed.map(c=>{
    const amt = VALID_CODES[c] ?? 0;
    return `<li><code>${c}</code> — ${amt ? '+'+fmt(amt)+' 🪙' : 'necunoscut'}</li>`;
  }).join('');
}
renderHistory();

codeRedeem.addEventListener('click', ()=>{
  const raw = (codeInput.value || '').trim().toLowerCase();
  if(!raw){ codeMsg.textContent = 'Introdu un cod.'; return; }
  if(redeemed.includes(raw)){
    codeMsg.textContent = 'Cod deja utilizat pe acest device.';
    return;
  }
  const amount = VALID_CODES[raw];
  if(!amount){
    codeMsg.textContent = 'Cod invalid.';
    return;
  }
  redeemed.push(raw);
  saveRedeemed();
  setBalance(balance + amount);
  toast(`+${fmt(amount)} Gobuxi ✅`);
  codeMsg.textContent = 'Cod activat cu succes!';
  codeInput.value = '';
});

/* default view */
showView('homeView');
</script>
</body>
</html>

